(function(a,b){if(typeof define==='function'&&define.amd){define(['jquery'],function($){return b(a,$)})}else if(typeof module==='object'&&typeof module.exports==='object'){module.exports=b(a,require('jquery'))}else{a.lity=b(a,a.jQuery||a.Zepto)}}(window,function(k,$){'use strict';var l=k.document;var m=$(k);var n=$('html');var o=0;var p=/\.(png|jpg|jpeg|gif|tiff|bmp)(\?\S*)?$/i;var q=/(youtube(-nocookie)?\.com|youtu\.be)\/(watch\?v=|v\/|u\/|embed\/?)?([\w-]{11})([&|\?]+list=([^&]+))?.*/i;var r=/(vimeo(pro)?.com)\/(?:[^\d]+)?(\d+)(?:.*)/;var s=/((maps|www)\.)?google\.([^\/\?]+)\/?((maps\/?)?\?)(.*)/i;var t={image:imageHandler,inline:inlineHandler,iframe:iframeHandler};var u={esc:true,handler:null,template:'<div class="lity" tabindex="-1"><div class="lity-wrap" data-lity-close><div class="lity-loader">Loading...</div><div class="lity-container"><div class="lity-content"></div><button class="lity-close" type="button" title="Close (Esc)" data-lity-close><i class="icon-close"></i></button></div></div></div>'};function globalToggle(){n[o>0?'addClass':'removeClass']('lity-active')}var v=(function(){var a=l.createElement('div');var b={WebkitTransition:'webkitTransitionEnd',MozTransition:'transitionend',OTransition:'oTransitionEnd otransitionend',transition:'transitionend'};for(var c in b){if(a.style[c]!==undefined){return b[c]}}return false})();function transitionEnd(a){var b=$.Deferred();if(!v){b.resolve()}else{a.one(v,b.resolve);setTimeout(b.resolve,500)}return b.promise()}function settings(a,b,c){if(arguments.length===1){return $.extend({},a)}if(typeof b==='string'){if(typeof c==='undefined'){return typeof a[b]==='undefined'?null:a[b]}a[b]=c}else{$.extend(a,b)}return this}function protocol(){return'file:'===k.location.protocol?'http:':''}function appendQueryParams(a,b){return a+(a.indexOf('?')>-1?'&':'?')+b}function error(a){return $('<span class="lity-error"/>').append(a)}function imageHandler(a){if(!p.test(a)){return false}var b=$('<img src="'+a+'">');var c=$.Deferred();var d=function(){c.reject(error('Failed loading image'))};b.on('load',function(){if(this.naturalWidth===0){return d()}c.resolve(b)}).on('error',d);return c.promise()}function inlineHandler(b){var c;try{c=$(b)}catch(e){return false}if(!c.length){return false}var d=$('<span style="display:none !important" class="lity-inline-placeholder"/>');return c.after(d).on('lity:ready',function(e,a){a.one('lity:remove',function(){d.before(c.addClass('lity-hide')).remove()})})}function iframeHandler(a){var b,url=a;b=q.exec(a);if(b){url=protocol()+'//www.youtube'+(b[2]||'')+'.com/embed/'+b[4];if(b[6]){url=appendQueryParams(url,'list='+b[6])}url=appendQueryParams(url,'autoplay=1')}b=r.exec(a);if(b){url=protocol()+'//player.vimeo.com/video/'+b[3]+'?autoplay=1'}b=s.exec(a);if(b){url=appendQueryParams(protocol()+'//www.google.'+b[3]+'/maps?'+b[6],'output='+(b[6].indexOf('layer=c')>0?'svembed':'embed'))}return'<div class="lity-iframe-container"><iframe frameborder="0" allowfullscreen src="'+url+'"></iframe></div>'}function lity(h){var j=$.extend({},u),_handlers=$.extend({},t),_instance,_content,_ready=$.Deferred().resolve();function keyup(e){if(e.keyCode===27){close()}}function resize(){var a=l.documentElement.clientHeight?l.documentElement.clientHeight:Math.round(m.height());_content.css('max-height',Math.floor(a)+'px').trigger('lity:resize',[_instance,popup])}function ready(b){if(!_instance){return}_content=$(b);m.on('resize',resize);resize();_instance.find('.lity-loader').each(function(){var a=$(this);transitionEnd(a).always(function(){a.remove()})});_instance.removeClass('lity-loading').find('.lity-content').empty().append(_content);_content.removeClass('lity-hide').trigger('lity:ready',[_instance,popup]);_ready.resolve()}function init(a,b,c){o++;globalToggle();_instance=$(c.template).addClass('lity-loading').appendTo('body');if(!!c.esc){m.one('keyup',keyup)}setTimeout(function(){_instance.addClass('lity-opened lity-'+a).on('click','[data-lity-close]',function(e){if($(e.target).is('[data-lity-close]')){close()}}).trigger('lity:open',[_instance,popup]);$.when(b).always(ready)},0)}function open(c,d){var e,content;if(d.handler&&_handlers[d.handler]){content=_handlers[d.handler](c,instance,popup);e=d.handler}else{var f=$.extend({},_handlers),lateHandlers={};$.each(['inline','iframe'],function(i,a){if(f[a]){lateHandlers[a]=f[a]}delete f[a]});var g=function(a,b){if(!b){return true}content=b(c,popup);if(!!content){e=a;return false}};$.each(f,g);if(!e){$.each(lateHandlers,g)}}if(content){_ready=$.Deferred();$.when(close()).done($.proxy(init,null,e,content,d))}return!!content}function close(){if(!_instance){return}var b=$.Deferred();_ready.done(function(){o--;globalToggle();m.off('resize',resize).off('keyup',keyup);_content.trigger('lity:close',[_instance,popup]);_instance.removeClass('lity-opened').addClass('lity-closed');var a=_instance,content=_content;_instance=null;_content=null;transitionEnd(content.add(a)).always(function(){content.trigger('lity:remove',[a,popup]);a.remove();b.resolve()})});return b.promise()}function popup(a){if(!a.preventDefault){return popup.open(a)}var b=$(this);var c=b.data('lity-target')||b.attr('href')||b.attr('src');if(!c){return}var d=$.extend({},j,b.data('lity-options')||b.data('lity'));if(open(c,d)){a.preventDefault()}}popup.handlers=$.proxy(settings,popup,_handlers);popup.options=$.proxy(settings,popup,j);popup.open=function(a){open(a,j);return popup};popup.close=function(){close();return popup};return popup.options(h)}lity.version='@VERSION';lity.handlers=$.proxy(settings,lity,t);lity.options=$.proxy(settings,lity,u);$(l).on('click','[data-lity]',lity());return lity}));
